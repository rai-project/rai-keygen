language: go
go:
- '1.8'
sudo: true
before_install:
- sudo add-apt-repository ppa:masterminds/glide -y
- sudo apt-get update -q
- sudo apt-get install glide -y
install:
- glide install
- go get github.com/mjibson/esc
- go get github.com/ahmetb/govvv
- go get github.com/franciscocpg/gox
- go get github.com/sanbornm/go-selfupdate
script:
- cd ${TRAVIS_BUILD_DIR}/cmd && go generate && cd ${TRAVIS_BUILD_DIR}
- VERSION=$(cat ./VERSION)
- echo "VERSION = ${VERSION}"
- DIST=${TRAVIS_BUILD_DIR}/dist/rai-keygen/stable
- CGO_ENABLED=0 gox -verbose -ldflags="$(govvv -flags)" -ldflags="-s -w" -os="linux
  darwin windows" -arch="amd64 386 armv5 armv6 armv7 arm64" -osarch="!darwin/arm64
  linux/ppc64 linux/ppc64le" -ldflags="-X github.com/rai-project/rai/cmd.appsecret=\"${APP_SECRET}\""
  -ldflags "-extldflags \"-static\"" -output="${DIST}/${VERSION}/{{.OS}}-{{.Arch}}/{{.Dir}}"
  .
before_deploy:
- echo "go-selfupdate generating bindiffs"
- mkdir -p ${DIST}/${VERSION}/binaries
- mkdir -p ${DIST}/latest
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/darwin-386     ${DIST}/${VERSION}/darwin-386/rai-keygen        ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/darwin-amd64   ${DIST}/${VERSION}/darwin-amd64/rai-keygen      ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-386      ${DIST}/${VERSION}/linux-386/rai-keygen         ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-amd64    ${DIST}/${VERSION}/linux-amd64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-armv5    ${DIST}/${VERSION}/linux-armv5/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-armv6    ${DIST}/${VERSION}/linux-armv6/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-armv7    ${DIST}/${VERSION}/linux-armv7/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-arm64    ${DIST}/${VERSION}/linux-arm64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-ppc64    ${DIST}/${VERSION}/linux-ppc64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/linux-ppc64le  ${DIST}/${VERSION}/linux-ppc64le/rai-keygen     ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/windows-386    ${DIST}/${VERSION}/windows-386/rai-keygen.exe   ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' czvf ${DIST}/${VERSION}/binaries/windows-amd64  ${DIST}/${VERSION}/windows-amd64/rai-keygen.exe
  ${TRAVIS_BUILD_DIR}/LICENSE.TXT ${TRAVIS_BUILD_DIR}/VERSION
- go-selfupdate -o ${DIST}/updates ${DIST}/${VERSION}/binaries/ ${VERSION}
- cp ${DIST}/${VERSION}/binaries/darwin-386    ${DIST}/latest/darwin-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/darwin-amd64  ${DIST}/latest/darwin-amd64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-386     ${DIST}/latest/linux-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-amd64   ${DIST}/latest/linux-amd64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv5   ${DIST}/latest/linux-armv5.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv6   ${DIST}/latest/linux-armv6.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv7   ${DIST}/latest/linux-armv7.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-arm64   ${DIST}/latest/linux-arm64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-ppc64   ${DIST}/latest/linux-ppc64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-ppc64le ${DIST}/latest/linux-ppc64le.tar.gz
- cp ${DIST}/${VERSION}/binaries/windows-386   ${DIST}/latest/windows-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/windows-amd64 ${DIST}/latest/windows-amd64.tar.gz
- rm -fr ${DIST}/${VERSION}/binaries
- echo "Copying latest directory to ${DIST}/${TRAVIS_COMMIT}"
- cp -r ${DIST}/latest ${DIST}/${TRAVIS_COMMIT}
deploy:
  provider: s3
  access_key_id: AKIAIAFSJLCCOYB5V3EQ
  secret_access_key:
    secure: A3N1yE+/qWrutLJ02EKp9pd93pxM9oRiUpQD8D1v4ozsQSTRWVTqzRPRi0e78nkk/VCvuq/pi0IyOCNOskIq6UKHckoXa3MwOorSD8YVWkUPV4vT44KC+Xx3qwoJLu4D2KCGD1L5A2n22WBMtw9aqqpeGabi4ee7Ax+YyPBkUgbdE8TNeupxF7KIhi7sCYUCeZ/w2Q8Z596iLWuSwdHGT+SqeKriGi9S8s175Zcj7z7cQzXeQRWOugx+5ZlUe4JprMt5dLVhYYzz7IYQOXQtddTkGG+VLc0YbmtVIjUcrWNcKkH9KY/VvnQBMyEgSxRRL4ALp9jxAE4ojs1IaOdAByhADZqHzbnLvQ9l+edi5lCMMXXw2ZrNHMBjKMrUNL75kAzd6vdbr+9Jlt2hmcvVJGC9TvPpMQloXio0CWDGXyF/NIADOdKJQjXy3jGVbA+j4d2B49jddz1dSE8X38fCxmh5yHmoWeTJyvRoJUWY1subEr+LyVy5ewewXdCXBGvcom6PC2LMdevCqGiRUgpH1lqF5tDeIK2Gw8IE48GlkdotptYS/BntNFqbiQWI9MNENa408UMgoCsXaLVFOZ9x34LDTUBcxTaDvCF0E4Myr/ri9pLyzmFU68MT/s8YZ31rXk1dxsUoopOFGptq3Az+E+QkfYOGG+kYy21hkHDZJoA=
  bucket: files.rai-project.com
  local-dir: dist
  upload-dir: dist
  acl: private
  skip_cleanup: true
  detect_encoding: true
  on:
    repo: rai-project/rai-keygen
env:
  global:
  - secure: d+9DHzWNAiK86FVQ9xdPL4tF/CD8rN3H4kgFZSbi/ydzBDoszWjA6b/r9FY6aF4ZelbLFUoEiemeB8q/yuv+lafqjJ6BsKCUvXkt07o00uI2PF7/8Cyoqp7BG/3lZ97eiG8CwQMXIJwk/NP1CzcCCXtTeyd5LTqwL2UKXKUyWuk/OjTbsg1ZkYMx2KmWXrtNaowPgglVwFiZfoXr9LR8SsB7D9d6teXimJNGOT0tmFnxnsxKjpud8l1aGJvMQ71ezZJYyGXhGhimZffNIBg4qQ76MLadTwAwLgHeE5IDrERDMFUhnHAV6DL9XU+xE9CTdSYnI7nbYLvr0MDWx997IA1v6NUMG6/fqpt/yK50wH/U8OuaRf0D9LpWIE2U64A7GTmB0UXkQorpLine8s4x//BCg0WdNPd0fJQ/WTQP9QoUvDZ+ElrgQnqYVNjsL59e0IKKOIIH0CkStQw86rfqqk1OmLlQIH3tFe+4iTaTuwIhn0z6769Aiza+rdn9f1Tc2QPL5gpFB92nnLLldRY1oxrnNgGpAzALNygXKDyBjSWtpvUWtx5TZ0V0T2x8/fWHhFcnjlPAHnm8TiAzGKK36risq/H9Zud56yiAFXz7swsbtpACp+wE99lWzb2DV+HbKa+wxp3pp5FL0nALH05oKPEi3jRGqeB4DFRHxZjR1aA=
  - secure: kaZLrf0Af1RQuauAX07cQVo5icCetPDJiYV+b+LBrfi1U3bksOw6M0VYWSrQVKOxM29oEMzqXm3DopO4+bH8HzjsOsADGXcPjHtccl4HkBBTn4vAIhAADFiB34/jj1gY6RhWAjSOAF/uX95VZezyQmcgy0qH1q3nRVVWWIHRisSrBtaqvr4mgsYVVHjvs4SB15sg/ryBhuU+npCWfNK1u+Z297JF8IfCQG5ws9fimJyyAiC7CkbP298eeMLuJlLkcmEIBuXayUU/hdf51gSLs23ykzZuQoZTlTzlCv8wpZtRtWRHXhekyc4fcaO8Zy+lKvVNxg17kRXhhcdpzTEyZl7QghaM5MgATfVEFyToQyFzH5yJAtQIgRegiKfueYM1wbbeUbfmlQFkMLnNkBHAPjgwwlukTdzu8cdFBoNRvI2Q9d4B80btL++AijoJWf6ZVHMTmQHf4shp1Wmxa4zqrXlRn4zTU4gtAmxT4r/f6qaF+/Qhu0acylw1dqODoOTLBWLR3N/mQlktIjP5ku2Ok8QDrTGWgnI2MmyLEGYfrO3fkWll8Mwqb+H9jaDNOfobNqvUhxW9oga57QUwyBk72w21CigwM2dioNIzjdVd01heRGLe4gE/2y7KhixcLzPJZsFQa3Kfyw+f/TP2fsHLwfkSKGAAXezLFklvThT0PeM=
