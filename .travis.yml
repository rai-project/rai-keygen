language: go
go:
- '1.8'
sudo: true
before_install:
- sudo add-apt-repository ppa:masterminds/glide -y
- sudo apt-get update -q
- sudo apt-get install glide -y
install:
- glide install
- go get github.com/mjibson/esc
- go get github.com/ahmetb/govvv
- go get github.com/franciscocpg/gox
- go get github.com/sanbornm/go-selfupdate
script:
- cd ${TRAVIS_BUILD_DIR}/cmd && go generate && cd ${TRAVIS_BUILD_DIR}
- VERSION=$(cat ./VERSION)
- echo "VERSION = ${VERSION}"
- DIST=${TRAVIS_BUILD_DIR}/dist/rai-keygen/stable
- CGO_ENABLED=0 gox -verbose -ldflags="$(govvv -flags)" -ldflags="-s -w" -os="linux
  darwin windows" -arch="amd64 386 armv5 armv6 armv7 arm64" -osarch="!darwin/arm64
  linux/ppc64 linux/ppc64le" -ldflags="-X github.com/rai-project/rai/cmd.appsecret=\"${APP_SECRET}\""
  -ldflags "-extldflags \"-static\"" -output="${DIST}/${VERSION}/{{.OS}}-{{.Arch}}/{{.Dir}}"
  .
before_deploy:
- echo "go-selfupdate generating bindiffs"
- mkdir -p ${DIST}/${VERSION}/binaries
- mkdir -p ${DIST}/latest
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/darwin-386     ${DIST}/${VERSION}/darwin-386/rai-keygen        ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/darwin-amd64   ${DIST}/${VERSION}/darwin-amd64/rai-keygen      ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-386      ${DIST}/${VERSION}/linux-386/rai-keygen         ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-amd64    ${DIST}/${VERSION}/linux-amd64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-armv5    ${DIST}/${VERSION}/linux-armv5/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-armv6    ${DIST}/${VERSION}/linux-armv6/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-armv7    ${DIST}/${VERSION}/linux-armv7/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-arm64    ${DIST}/${VERSION}/linux-arm64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-ppc64    ${DIST}/${VERSION}/linux-ppc64/rai-keygen       ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/linux-ppc64le  ${DIST}/${VERSION}/linux-ppc64le/rai-keygen     ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/windows-386    ${DIST}/${VERSION}/windows-386/rai-keygen.exe   ${TRAVIS_BUILD_DIR}/LICENSE.TXT
  ${TRAVIS_BUILD_DIR}/VERSION
- tar --transform 's/.*\///g' -czvf ${DIST}/${VERSION}/binaries/windows-amd64  ${DIST}/${VERSION}/windows-amd64/rai-keygen.exe
  ${TRAVIS_BUILD_DIR}/LICENSE.TXT ${TRAVIS_BUILD_DIR}/VERSION
- go-selfupdate -o ${DIST}/updates ${DIST}/${VERSION}/binaries/ ${VERSION}
- cp ${DIST}/${VERSION}/binaries/darwin-386    ${DIST}/latest/darwin-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/darwin-amd64  ${DIST}/latest/darwin-amd64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-386     ${DIST}/latest/linux-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-amd64   ${DIST}/latest/linux-amd64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv5   ${DIST}/latest/linux-armv5.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv6   ${DIST}/latest/linux-armv6.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-armv7   ${DIST}/latest/linux-armv7.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-arm64   ${DIST}/latest/linux-arm64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-ppc64   ${DIST}/latest/linux-ppc64.tar.gz
- cp ${DIST}/${VERSION}/binaries/linux-ppc64le ${DIST}/latest/linux-ppc64le.tar.gz
- cp ${DIST}/${VERSION}/binaries/windows-386   ${DIST}/latest/windows-386.tar.gz
- cp ${DIST}/${VERSION}/binaries/windows-amd64 ${DIST}/latest/windows-amd64.tar.gz
- rm -fr ${DIST}/${VERSION}/binaries
- echo "Copying latest directory to ${DIST}/${TRAVIS_COMMIT}"
- cp -r ${DIST}/latest ${DIST}/${TRAVIS_COMMIT}
deploy:
  provider: s3
  access_key_id: AKIAIAFSJLCCOYB5V3EQ
  secret_access_key:
    secure: Atz9WGVPBu7pyIE/Lc/tfri5oVMy+cOLtzopog3VFAViBbDBse4pxi6MNEzQqRBk7vTBPMmDqkIOftz+ml/B4GP5EN2G4hJBFTNdvzURDfYvdUGKZHQJztc5RWuF1su5EVOUm/r9y8Yb39j+7Qv4hHOfQtfot3bjyscZtUGDwOnxcTB0kevits5xzaOOqX+n5YY73I8xC/NedoYfHNjEMmCxAujPOQLmn/etlxt8sGROFDHRxGgUhRIggb2O7DjzJNtcO/33seg2YoYq3u5H9rw/IE6HHBxlqw0JsH9qoiHMGqNmllRPllSdZSXMupBBuPhn9f8sd2BKJZIuCMdNvItjvZAKsfZsVHpWL6+S4xgmA2P3sYSE9e9Skos8xjB/np9X/b3oSkK4d2TUjMStkqvH8wJ+PYiDeU4IJf+NbtJ7fLRYK9u5cCRJC3ng9iTEMfFEgO2FBahBkohyB9JuMDsKeQrlJH+xXP4zS7w+B1uLiX+286nOYUu3aNCuapPFKWlBb8soGivaUakYafxT4mJ0ihS9LSdwtD2Mgbbij+TC4Z/n+OFJ7SAed1nF5XyTJuLWcp4thoeGEbq9pULkFX9PMoobqzFZZuL+bL9EHkhYx6dY8ze+Q6y0ROjY3R884BY/MgM8nm7nsE66uP5p0TLOuANMQRZo+iVH9kQgGqI=
  bucket: files.rai-project.com
  local-dir: dist
  upload-dir: dist
  acl: private
  skip_cleanup: true
  detect_encoding: true
  on:
    repo: rai-project/rai-keygen
env:
  global:
  - secure: VdWmAuqcbbsB4GR3rhwEnLVpwrLa/hyX+ngYWanmNhe2sIwUIBCGY5RTUUt3Vbj89lecuxqU6RqDnfqj3K+0xR1qHUU9JLCJpy4Axp7KMXwLH2gER0WTRsTbsqs3hTEwGhXEaDXdPzKGb6P3oAkITdd07afk0DO0QQAXJsot7lDKxc95COQVjxwCTiQe1wCge1B/VZSsXK3KebF2PntwQEPNilM5CW0CCNWp7HkMVXr8NvLNM/9XPxxpzm0oZalYyWtJQimPtj/R2k5Vo43z3J/kQyR3Ys+3C6RZg7aR8w0eIS2dE4D5Bo+hejcsqCpSRl9xLmtbDHNZZ3Y/R9O7k4UCYe0tF80DFaknY2BmQvDW2uj9qvRxw5TLU90my0B/n2n4Fr5xAzmb+vhTDLc3CGGyfVxNxI/qTCZhmyjdYlbD+sbzbgmWpQX7CELX+A1+Z9VuPGlZI3k1nvDwBpxA/xSHbrBcCxdsAlJj8xoaqOZCHxWc9IM1lSeh81eSnJY3ZvX4dCnbA0I/+TEbFLV2iUNKGnNyMCkLsTa8TaE7YPiWoR42PH2xBwXiRCAbfASNNY/Yw7HU86JXhaAR2q0p3svP6qI+yOG0B3QX0mIq5aQNRKybNQx19xVGUrXQ4dZJhofe0DTx2aAI9aa6fmC1gDNpyQ+ksa0Oadb7LTIuyWs=
  - secure: grMBv/wVFaxJl70nlAlM5LaJN4Nlim740yp6YbI3cBoTcbH6mMiIo0VYOvW6idvlUuuk2XNM2jsVPC60UGsH2o2cCOo64e9OBroYTIAEsN7jQWvF+lzRFL9HXIHaIkRdYtEcoOquu1zLQ+QIY2zK4Uer+2p8RzvmQ5FmAwInq9uvONyBDdy9ChU5cxJgXJr+2xxdhY9lQkMqp5WmDCTQDAM4dkC8v35oyNywqiEpsTjRuVVozocWGoJV6V4fYW2au0Hgrvhp4Cdf0CkhQ8t9IjlXW6uS6GYI2uCRuUr55rEAehes0kUXwrwfZcrrwmFlHA/5fxlhXieq8tdIXTYGDJSH3IApqyrn7HXJ0cZ8QhFyPFH0GghGGVEtKKGgYMiYTYgMF5FQLUI6I+0fA1RKw7jMgHLcT9PWVJKVxvjIYcC4CWco7r9TDAKSCbj+YD78g6C0g10lMBK8x5XA5IBaW2Iyfj6+Db55MNCv7IYShSWqaqfQibv4dAMx7QfmQZIBQOY/c98xcPvooNhqRbumh6QC5qToUqZ/+w8Ih52lQH08f765u52JwVM7y4RP0+dlYUGObUpwDVsDCL/vlTOOufNiiLRfWCsxxSlCaiExt7a+RAA4tdGEdA6nakNsmK5Oez9KsUF0i2JL1SZWvVwzCVnc0pePRdEoV+0yfV7BfuA=
